"use strict";(self.webpackChunkworklenz=self.webpackChunkworklenz||[]).push([[101],{5101:(se,U,o)=>{o.r(U),o.d(U,{KpisModule:()=>tt});var t=o(96814),b=o(66987),I=o(81221),m=o(60095),Z=o(3599),f=o(20824),x=o(95717),J=o(26254),C=o(42840),u=o(13740),R=o(79382),A=o(62595),F=o(16976),h=o(8083),T=o(9691),Y=o(55695),Q=o(62612),K=o(48128),k=o(19035),L=o(96928),N=o(96109),w=o(24139),H=o(57907),P=o(52682),j=o(60804),B=o(6361),D=o(82962),O=o(92574),W=o(3626),$=o(28538),c=o(96494),z=o(90694),d=o(82669),g=o(33410),_=o(33640),M=o(57417),S=o(90565),le=o(22114),pe=o(43389),ce=o(62787),de=o(26236),ge=o(98421),me=o(93903),ue=o(77835),_e=o(99183),he=o(66770),ze=o(13490),fe=o(58684),Ce=o(12996),Te=o(38125),Me=o(26501),xe=o(331),ve=o(6192),Ze=o(63392),Ae=o(61320),be=o(68907),Ke=o(63577),De=o(47246),ye=o(670),Re=o(16406),e=o(65879),V=o(99753),q=o(43460),X=o(9435),E=o(52787),ee=o(10095),G=o(70855),te=o(41958),Pe=o(15861),Oe=o(55416),ne=o(45538);function Se(r,l){if(1&r&&e._UZ(0,"nz-option",4),2&r){const i=l.$implicit;e.s9C("nzLabel",i.name),e.Q6J("nzValue",i.id)}}function Ue(r,l){if(1&r&&e._UZ(0,"nz-option",4),2&r){const i=l.$implicit;e.s9C("nzLabel",i.name),e.Q6J("nzValue",i.id)}}let oe=(()=>{var r;class l{constructor(n,a){this.service=n,this.teamMembersApiService=a,this.assignChanged=new e.vpe,this.members=[],this.selectedResponsible=null,this.selectedAccountable=null,this.disabled=!1}ngOnInit(){var n=this;return(0,Pe.Z)(function*(){const a=yield n.teamMembersApiService.getAll();n.members=a.body,console.log(n.members)})()}onResponsibleChange(n){console.log(n),this.selectedResponsible=n,this.emitSelection()}onAccountableChange(n){console.log(n),this.selectedAccountable=n,this.emitSelection()}emitSelection(){this.selectedResponsible&&this.selectedAccountable&&this.assignChanged.emit({responsible:this.selectedResponsible,accountable:this.selectedAccountable})}}return(r=l).\u0275fac=function(n){return new(n||r)(e.Y36(Oe.b),e.Y36(ne.B))},r.\u0275cmp=e.Xpm({type:r,selectors:[["worklenz-app-kpi-assign"]],inputs:{selectedResponsible:"selectedResponsible",selectedAccountable:"selectedAccountable",disabled:"disabled"},outputs:{assignChanged:"assignChanged"},decls:5,vars:6,consts:[[1,"dropdowns-container"],["nzPlaceHolder","Select Responsible",3,"disabled","ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzPlaceHolder","Select Accountable",3,"disabled","ngModel","ngModelChange"],[3,"nzValue","nzLabel"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0)(1,"nz-select",1),e.NdJ("ngModelChange",function(p){return a.selectedResponsible=p})("ngModelChange",function(p){return a.onResponsibleChange(p)}),e.YNc(2,Se,1,2,"nz-option",2),e.qZA(),e.TgZ(3,"nz-select",3),e.NdJ("ngModelChange",function(p){return a.selectedAccountable=p})("ngModelChange",function(p){return a.onAccountableChange(p)}),e.YNc(4,Ue,1,2,"nz-option",2),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("disabled",a.disabled)("ngModel",a.selectedResponsible),e.xp6(1),e.Q6J("ngForOf",a.members),e.xp6(1),e.Q6J("disabled",a.disabled)("ngModel",a.selectedAccountable),e.xp6(1),e.Q6J("ngForOf",a.members))},dependencies:[t.sg,m.JJ,T.Ip,T.Vq,m.On]}),l})();function Ie(r,l){if(1&r&&e._UZ(0,"nz-option",19),2&r){const i=l.$implicit;e.Q6J("nzValue",i.value)("nzLabel",i.label)}}function Je(r,l){if(1&r&&e._UZ(0,"nz-option",19),2&r){const i=l.$implicit;e.Q6J("nzValue",i.value)("nzLabel",i.label)}}function Ye(r,l){if(1&r){const i=e.EpF();e.TgZ(0,"tr",8)(1,"td"),e._UZ(2,"input",9),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"textarea",10),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"input",11),e.qZA(),e.TgZ(7,"td")(8,"nz-select",12),e.YNc(9,Ie,1,2,"nz-option",13),e.qZA()(),e.TgZ(10,"td"),e._UZ(11,"input",14),e.qZA(),e.TgZ(12,"td")(13,"nz-select",15),e.YNc(14,Je,1,2,"nz-option",13),e.qZA()(),e.TgZ(15,"td")(16,"worklenz-app-kpi-assign",16),e.NdJ("assignChanged",function(a){const p=e.CHM(i).index,v=e.oxw();return e.KtG(v.onAssignChanged(p,a))}),e.qZA()(),e.TgZ(17,"td")(18,"button",17),e.NdJ("click",function(){const s=e.CHM(i).index,p=e.oxw();return e.KtG(p.removeKpi(s))}),e._UZ(19,"i",18),e.qZA()()()}if(2&r){const i=l.$implicit,n=e.oxw();e.Q6J("formGroup",i),e.xp6(9),e.Q6J("ngForOf",n.frequencyOptions),e.xp6(5),e.Q6J("ngForOf",n.unitOptions)}}let Le=(()=>{var r;class l{constructor(n,a,s,p,v){this.fb=n,this.kpiService=a,this.message=s,this.auth=p,this.router=v,this.loading=!1,this.frequencyOptions=[{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Quarterly",value:"quarterly"},{label:"Yearly",value:"yearly"},{label:"Per Project",value:"per_project"}],this.unitOptions=[{label:"Percentage %",value:"percentage"},{label:"Dollar $",value:"dollar"},{label:"Calls",value:"calls"},{label:"Meetings",value:"meetings"},{label:"MSA",value:"msa"},{label:"NDA",value:"nda"},{label:"MOU",value:"mou"}]}ngOnInit(){this.user=this.auth.getCurrentSession(),this.kpiForm=this.fb.group({kpis:this.fb.array([])}),this.addKpi()}get kpiControls(){return this.kpiForm.get("kpis").controls}addKpi(){const n=this.fb.group({name:["",m.kI.required],description:[""],calculation_method:["",m.kI.required],frequency:["",m.kI.required],target_value:[null,m.kI.required],current_value:[null],unit:["",m.kI.required],responsible_id:["",m.kI.required],accountable_id:["",m.kI.required],user_id:[this.user.id,m.kI.required],created_by:[this.user.id,m.kI.required]});this.kpiForm.get("kpis").push(n)}removeKpi(n){this.kpiForm.get("kpis").removeAt(n)}onAssignChanged(n,a){const s=this.kpiControls[n];s.controls.responsible_id.setValue(a.responsible),s.controls.accountable_id.setValue(a.accountable)}submitForm(){this.kpiForm.invalid?this.message.warning("Please fill in the required fields"):(this.loading=!0,this.kpiService.create(this.kpiForm.value.kpis).subscribe(n=>{this.message.success("KPIs created successfully"),this.kpiForm.reset(),this.loading=!1,this.router.navigate(["/opom/kpis"])},n=>{this.message.error("Error creating KPIs"),this.loading=!1}))}}return(r=l).\u0275fac=function(n){return new(n||r)(e.Y36(m.qu),e.Y36(V.O),e.Y36(q.dD),e.Y36(X.e),e.Y36(E.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["worklenz-create-kpi"]],decls:31,vars:7,consts:[[1,"container"],["nz-form","",3,"formGroup","ngSubmit"],[3,"nzData","nzBordered"],["basicTable",""],[3,"formGroup",4,"ngFor","ngForOf"],[1,"text-right",3,"nzSpan"],["nz-button","","nzType","primary",3,"disabled"],["nz-button","","nzType","default",3,"disabled","click"],[3,"formGroup"],["nz-input","","formControlName","name","placeholder","Enter KPI name"],["nz-input","","formControlName","description","placeholder","Enter KPI Objective"],["nz-input","","formControlName","calculation_method","placeholder","Calculation Method"],["formControlName","frequency","nzPlaceHolder","Select Frequency"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-input","","type","number","formControlName","target_value","placeholder","Target Value"],["formControlName","unit","nzPlaceHolder","Select Target Value Type"],[3,"assignChanged"],["nz-button","","nzType","default","nzShape","circle","nzDanger","",3,"click"],["nz-icon","","nzType","delete"],[3,"nzValue","nzLabel"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0)(1,"nz-card")(2,"form",1),e.NdJ("ngSubmit",function(){return a.submitForm()}),e.TgZ(3,"nz-table",2,3)(5,"thead")(6,"tr")(7,"th"),e._uU(8,"KPI Name"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Objective"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Calculation Method"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Frequency"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Target Value"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Target Value Type"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Responsible / Accountable"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Actions"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,Ye,20,3,"tr",4),e.qZA()(),e.TgZ(25,"nz-form-item")(26,"nz-form-control",5)(27,"button",6),e._uU(28,"Create KPI"),e.qZA()()(),e.TgZ(29,"button",7),e.NdJ("click",function(){return a.addKpi()}),e._uU(30,"Add KPI"),e.qZA()()()()),2&n&&(e.xp6(2),e.Q6J("formGroup",a.kpiForm),e.xp6(1),e.Q6J("nzData",a.kpiControls)("nzBordered",!0),e.xp6(21),e.Q6J("ngForOf",a.kpiControls),e.xp6(2),e.Q6J("nzSpan",24),e.xp6(1),e.Q6J("disabled",a.loading),e.xp6(2),e.Q6J("disabled",a.loading))},dependencies:[t.sg,m._Y,m.Fj,m.wV,m.JJ,m.JL,m.sg,m.u,ee.t3,ee.SK,Z.Lr,Z.Nx,Z.Fd,f.Zp,C.ix,G.w,te.dQ,u.N8,u.Uo,u._C,u.Om,u.p0,u.$Z,A.Ls,T.Ip,T.Vq,D.bd,oe]}),l})();function Ee(r,l){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._UZ(12,"worklenz-app-kpi-assign",9),e.qZA()()),2&r){const i=l.$implicit;e.xp6(2),e.Oqu(i.name),e.xp6(2),e.Oqu(i.description||"-"),e.xp6(2),e.Oqu(i.frequency),e.xp6(2),e.Oqu(i.target_value),e.xp6(2),e.Oqu(i.unit),e.xp6(2),e.Q6J("disabled",!0)("selectedResponsible",i.responsible_id)("selectedAccountable",i.accountable_id)}}let Fe=(()=>{var r;class l{constructor(n,a,s,p){this.kpiService=n,this.message=a,this.teamMembersApiService=s,this.auth=p,this.kpis=[],this.loading=!1,this.teamMembersCache={}}ngOnInit(){this.getKpis()}getKpis(){this.loading=!0;const n=this.auth.getCurrentSession()?.id??"";this.kpiService.getByUserId(n).subscribe(a=>{this.kpis=a.body,this.loading=!1},a=>{this.message.error("Error fetching KPIs"),this.loading=!1})}}return(r=l).\u0275fac=function(n){return new(n||r)(e.Y36(V.O),e.Y36(q.dD),e.Y36(ne.B),e.Y36(X.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["worklenz-list-kpis"]],decls:28,vars:9,consts:[[1,"container"],["nz-button","",3,"routerLink","nzType"],["nz-icon","","nzType","edit","nzTheme","outline"],[3,"nzBordered","nzData","nzLoading","nzSize"],["basicTable",""],["nzWidth","15%"],["nzWidth","20%"],["nzWidth","10%"],[4,"ngFor","ngForOf"],[3,"disabled","selectedResponsible","selectedAccountable"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0)(1,"nz-card")(2,"nz-button-group")(3,"button",1),e._UZ(4,"span",2),e._uU(5,"Create KPI"),e.qZA(),e._UZ(6,"br"),e.TgZ(7,"button",1),e._UZ(8,"span",2),e._uU(9,"Kpis Reports"),e.qZA()(),e.TgZ(10,"nz-table",3,4)(12,"thead")(13,"tr")(14,"th",5),e._uU(15,"KPI Name"),e.qZA(),e.TgZ(16,"th",6),e._uU(17,"Objective"),e.qZA(),e.TgZ(18,"th",7),e._uU(19,"Frequency"),e.qZA(),e.TgZ(20,"th",7),e._uU(21,"Target Value"),e.qZA(),e.TgZ(22,"th",7),e._uU(23,"Target Value Type"),e.qZA(),e.TgZ(24,"th",5),e._uU(25,"Responsible / Accountable"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,Ee,13,8,"tr",8),e.qZA()()()()),2&n&&(e.xp6(3),e.Q6J("routerLink","create")("nzType","primary"),e.xp6(4),e.Q6J("routerLink","KpiReports")("nzType","primary"),e.xp6(3),e.Q6J("nzBordered",!0)("nzData",a.kpis)("nzLoading",a.loading)("nzSize","middle"),e.xp6(17),e.Q6J("ngForOf",a.kpis))},dependencies:[t.sg,E.rH,C.ix,C.fY,G.w,te.dQ,u.N8,u.Uo,u._C,u.Om,u.p0,u.$Z,A.Ls,D.bd,oe]}),l})();var Qe=o(78645),ae=o(59773),ke=o(22078),ie=o(63106),Ne=o(2919);function we(r,l){if(1&r&&e._UZ(0,"nz-option",18),2&r){const i=l.$implicit;e.Q6J("nzValue",i.id)("nzLabel",i.name)}}function He(r,l){if(1&r&&e._UZ(0,"nz-option",18),2&r){const i=l.$implicit;e.Q6J("nzValue",i.id)("nzLabel",i.name)}}function je(r,l){if(1&r&&e._UZ(0,"nz-option",18),2&r){const i=l.$implicit;e.Q6J("nzValue",i.id)("nzLabel",i.name)}}function Be(r,l){if(1&r){const i=e.EpF();e.TgZ(0,"nz-range-picker",11),e.NdJ("ngModelChange",function(a){e.CHM(i);const s=e.oxw();return e.KtG(s.dateRange=a)})("ngModelChange",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.loadInitialKpis())}),e.qZA(),e.TgZ(1,"nz-select",12),e.NdJ("ngModelChange",function(a){e.CHM(i);const s=e.oxw();return e.KtG(s.selectedMembers=a)})("ngModelChange",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.loadInitialKpis())}),e.YNc(2,we,1,2,"nz-option",13),e.qZA(),e.TgZ(3,"nz-select",14),e.NdJ("ngModelChange",function(a){e.CHM(i);const s=e.oxw();return e.KtG(s.selectedProjects=a)})("ngModelChange",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.loadInitialKpis())}),e.YNc(4,He,1,2,"nz-option",13),e.qZA(),e.TgZ(5,"nz-select",15),e.NdJ("ngModelChange",function(a){e.CHM(i);const s=e.oxw();return e.KtG(s.selectedKpis=a)})("ngModelChange",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.loadInitialKpis())}),e.YNc(6,je,1,2,"nz-option",13),e.qZA(),e.TgZ(7,"nz-input-group",16)(8,"input",17),e.NdJ("ngModelChange",function(a){e.CHM(i);const s=e.oxw();return e.KtG(s.searchText=a)})("ngModelChange",function(){e.CHM(i);const a=e.oxw();return e.KtG(a.searchKpis())}),e.qZA()()}if(2&r){const i=e.oxw(),n=e.MAs(6);e.Q6J("ngModel",i.dateRange),e.xp6(1),e.Q6J("ngModel",i.selectedMembers),e.xp6(1),e.Q6J("ngForOf",i.members),e.xp6(1),e.Q6J("ngModel",i.selectedProjects),e.xp6(1),e.Q6J("ngForOf",i.projects),e.xp6(1),e.Q6J("ngModel",i.selectedKpis),e.xp6(1),e.Q6J("ngForOf",i.kpiNames),e.xp6(1),e.Q6J("nzSuffix",n),e.xp6(1),e.Q6J("ngModel",i.searchText)}}function We(r,l){1&r&&e._UZ(0,"span",19)}function $e(r,l){if(1&r&&(e._UZ(0,"nz-avatar",27),e.ALo(1,"firstCharUpper")),2&r){const i=e.oxw().$implicit;e.Udp("background-color","#1890ff"),e.Q6J("nzSrc",i.member_avatar||"")("nzText",e.lcZ(1,4,i.member_name)||"")}}function Ve(r,l){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&r){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.member_name)}}function Ge(r,l){if(1&r){const i=e.EpF();e.TgZ(0,"tr",20),e.NdJ("click",function(){const s=e.CHM(i).$implicit,p=e.oxw();return e.KtG(p.openKpiDetails(s))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"nz-space",21),e.YNc(9,$e,2,6,"nz-avatar",22),e.YNc(10,Ve,2,1,"span",23),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td",24),e._uU(14),e.qZA(),e.TgZ(15,"td",24),e._uU(16),e.qZA(),e.TgZ(17,"td"),e._UZ(18,"nz-progress",25),e.qZA(),e.TgZ(19,"td",24)(20,"nz-tag",26),e._uU(21),e.qZA()()()}if(2&r){const i=l.$implicit,n=e.oxw();e.xp6(2),e.Oqu(i.kpi_name),e.xp6(2),e.Oqu(i.kpi_description),e.xp6(2),e.Oqu(i.task_name),e.xp6(6),e.Oqu(i.project_name||"N/A"),e.xp6(2),e.AsE("",i.target_value," ",i.unit,""),e.xp6(2),e.Oqu(i.current_value),e.xp6(2),e.Q6J("nzPercent",n.getCompletionPercentage(i.completion_percentage))("nzShowInfo",!0),e.xp6(2),e.Q6J("nzColor",n.getStatusColor(i.status)),e.xp6(1),e.Oqu(i.status)}}const qe=function(){return{x:"300px"}},Xe=[{path:"",component:Fe},{path:"create",component:Le},{path:"KpiReports",component:(()=>{var r;class l{constructor(n,a,s){this.kpiService=n,this.notification=a,this.cdr=s,this.loading=!1,this.isDurationLabelSelected=!1,this.searchText="",this.dateRange=[],this.pageIndex=1,this.pageSize=10,this.total=0,this.paginationSizes=[10,20,50,100],this.allKpis=[],this.kpis=[],this.members=[],this.projects=[],this.kpiNames=[],this.selectedMembers=[],this.selectedProjects=[],this.selectedKpis=[],this.destroy$=new Qe.x}ngOnInit(){this.loadInitialKpis()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadInitialKpis(){this.loading=!0,this.kpiService.getKpiReport({page:1,size:1e4}).pipe((0,ae.R)(this.destroy$)).subscribe({next:n=>{this.allKpis=n.body?.data||[],this.total=this.allKpis.length,this.initializeFilterOptions(),this.filterKpis(),this.loading=!1,this.cdr.detectChanges()},error:n=>{console.error("Failed to load KPIs:",n),this.notification.error("Error","Failed to load KPI data"),this.loading=!1,this.cdr.detectChanges()}})}initializeFilterOptions(){this.members=this.extractUnique(this.allKpis,"team_member_id","member_name"),this.projects=this.extractUnique(this.allKpis,"project_id","project_name"),this.kpiNames=this.extractUnique(this.allKpis,"kpi_id","kpi_name")}filterKpis(){this.kpis=this.allKpis.filter(n=>{const a=!this.dateRange.length||new Date(n.start_date)>=this.dateRange[0]&&new Date(n.end_date)<=this.dateRange[1],s=!this.selectedMembers.length||this.selectedMembers.includes(n.team_member_id),p=!this.selectedProjects.length||this.selectedProjects.includes(n.project_id),v=!this.selectedKpis.length||this.selectedKpis.includes(n.kpi_id),y=!this.searchText||n.kpi_name.toLowerCase().includes(this.searchText.toLowerCase());return a&&s&&p&&v&&y}),this.total=this.kpis.length,this.pageIndex=1,this.updateDisplayedData()}searchKpis(){this.filterKpis()}onQueryParamsChange(n){this.pageIndex=n.pageIndex,this.pageSize=n.pageSize,this.updateDisplayedData()}updateDisplayedData(){const n=(this.pageIndex-1)*this.pageSize;this.kpis=this.kpis.slice(n,n+this.pageSize),this.cdr.detectChanges()}exportToExcel(){if(!this.dateRange||this.dateRange.length<2)return void this.notification.warning("Warning","Please select a date range first");const n={start_date:this.formatDate(this.dateRange[0]),end_date:this.formatDate(this.dateRange[1]),team_id:this.selectedMembers.join(","),project_id:this.selectedProjects.join(","),member_id:this.selectedMembers.join(","),kpi_id:this.selectedKpis.join(",")};this.kpiService.exportKpiReport(n).pipe((0,ae.R)(this.destroy$)).subscribe({next:a=>{const s=window.URL.createObjectURL(a),p=document.createElement("a");p.href=s,p.download=`KPI_Report_${(new Date).toISOString()}.xlsx`,p.click(),window.URL.revokeObjectURL(s)},error:a=>{console.error("Failed to export report:",a),this.notification.error("Error","Failed to export KPI report")}})}getStatusColor(n){if(!n)return"default";switch(n.toLowerCase()){case"completed":case"on track":return"success";case"at risk":return"warning";case"off track":return"error";default:return"default"}}getCompletionPercentage(n){return parseFloat(n)||0}openKpiDetails(n){console.log("Opening KPI details for:",n)}trackBy(n,a){return a.id}extractUnique(n,a,s){const p=new Map;return n.forEach(v=>{const y=v[a],re=v[s];y&&re&&!p.has(y)&&p.set(y,{id:y,name:re})}),Array.from(p.values())}formatDate(n){return`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`}}return(r=l).\u0275fac=function(n){return new(n||r)(e.Y36(V.O),e.Y36(ke.zb),e.Y36(e.sBO))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-kpi-reports"]],decls:31,vars:19,consts:[[3,"title","showDuration","showArchivedToggle","isDurationLabelSelected","exportFile"],[3,"nzLoading","nzTitle","nzExtra"],["kpiActions",""],["suffixIconSearch",""],["nzSize","small",3,"nzData","nzFrontPagination","nzLoading","nzPageIndex","nzPageSizeOptions","nzPageSize","nzTotal","nzShowSizeChanger","nzHideOnSinglePage","nzScroll","nzPageIndexChange","nzPageSizeChange","nzQueryParams"],["table",""],["nzWidth","250px"],["nzWidth","200px"],["nzWidth","120px",1,"text-center"],["nzWidth","220px"],["class","cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["nzFormat","yyyy-MM-dd","nzPlaceHolder","Select Date Range",3,"ngModel","ngModelChange"],["nzMode","multiple","nzAllowClear","","nzPlaceHolder","Select Members",1,"w-25",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzMode","multiple","nzAllowClear","","nzPlaceHolder","Select Projects",1,"w-25",3,"ngModel","ngModelChange"],["nzMode","multiple","nzAllowClear","","nzPlaceHolder","Select KPIs",1,"w-25",3,"ngModel","ngModelChange"],[2,"width","250px",3,"nzSuffix"],["type","text","nz-input","","placeholder","Search by KPI name or description",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel"],["nz-icon","","nzType","search"],[1,"cursor-pointer",3,"click"],[1,"align-items-center"],[3,"nzSrc","nzText","background-color",4,"nzSpaceItem"],[4,"nzSpaceItem"],[1,"text-center"],["nzStatus","success",3,"nzPercent","nzShowInfo"],[3,"nzColor"],[3,"nzSrc","nzText"]],template:function(n,a){if(1&n&&(e.TgZ(0,"worklenz-rpt-header",0),e.NdJ("isDurationLabelSelected",function(p){return a.isDurationLabelSelected=p})("exportFile",function(){return a.exportToExcel()}),e.qZA(),e.TgZ(1,"nz-content")(2,"nz-card",1),e.YNc(3,Be,9,9,"ng-template",null,2,e.W1O),e.YNc(5,We,1,0,"ng-template",null,3,e.W1O),e.TgZ(7,"nz-table",4,5),e.NdJ("nzPageIndexChange",function(p){return a.pageIndex=p})("nzPageSizeChange",function(p){return a.pageSize=p})("nzQueryParams",function(p){return a.onQueryParamsChange(p)}),e.TgZ(9,"thead")(10,"tr")(11,"th",6),e._uU(12,"KPI Name"),e.qZA(),e.TgZ(13,"th",6),e._uU(14,"KPI Description"),e.qZA(),e.TgZ(15,"th",6),e._uU(16,"Task Name"),e.qZA(),e.TgZ(17,"th",7),e._uU(18,"Team Member"),e.qZA(),e.TgZ(19,"th",7),e._uU(20,"Project"),e.qZA(),e.TgZ(21,"th",8),e._uU(22,"Target Value"),e.qZA(),e.TgZ(23,"th",8),e._uU(24,"Current Value"),e.qZA(),e.TgZ(25,"th",9),e._uU(26,"Completion"),e.qZA(),e.TgZ(27,"th",8),e._uU(28,"Status"),e.qZA()()(),e.TgZ(29,"tbody"),e.YNc(30,Ge,22,11,"tr",10),e.qZA()()()()),2&n){const s=e.MAs(4),p=e.MAs(8);e.Q6J("title","KPI Performance")("showDuration",!0)("showArchivedToggle",!1),e.xp6(2),e.Q6J("nzLoading",a.loading)("nzTitle","")("nzExtra",s),e.xp6(5),e.Q6J("nzData",a.allKpis)("nzFrontPagination",!1)("nzLoading",a.loading)("nzPageIndex",a.pageIndex)("nzPageSizeOptions",a.paginationSizes)("nzPageSize",a.pageSize)("nzTotal",a.total)("nzShowSizeChanger",!0)("nzHideOnSinglePage",!0)("nzScroll",e.DdM(18,qe)),e.xp6(23),e.Q6J("ngForOf",p.data)("ngForTrackBy",a.trackBy)}},dependencies:[t.sg,ie.I,m.Fj,m.JJ,f.Zp,f.gB,f.ke,G.w,u.N8,u.Uo,u._C,u.Om,u.p0,u.$Z,A.Ls,T.Ip,T.Vq,Y.j,m.On,K.M,L.Dz,P.uw,P.wS,D.bd,O.NU,O.$1,g.OK,Ne.I],styles:[".report-filters[_ngcontent-%COMP%]{display:flex;margin-bottom:16px}.report-filters[_ngcontent-%COMP%]   .filter-select[_ngcontent-%COMP%]{min-width:200px}nz-table[_ngcontent-%COMP%]{margin-top:16px}nz-table[_ngcontent-%COMP%]   .ant-progress-text[_ngcontent-%COMP%]{margin-left:8px;min-width:40px;display:inline-block}nz-avatar[_ngcontent-%COMP%]{margin-right:8px}.ml-2[_ngcontent-%COMP%]{margin-left:8px}.mb-3[_ngcontent-%COMP%]{margin-bottom:16px}"],changeDetection:0}),l})()}];let et=(()=>{var r;class l{}return(r=l).\u0275fac=function(n){return new(n||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[E.Bz.forChild(Xe),E.Bz]}),l})(),tt=(()=>{var r;class l{}return(r=l).\u0275fac=function(n){return new(n||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[t.ez,et,ie.I,t.ez,b.S,I.Qp,m.UX,Z.U5,f.o7,x.ic,J.KJ,C.sL,u.HQ,R.we,A.PV,F.Ph,h.ZJ,T.LV,Y.X,m.u5,Q.Wr,K.W,k._p,L.Rt,N.cg,w.H0,H.aF,P.Hb,j.Xo,B.Cl,D.vh,O.zf,W.lt,$.j,g.wm,c.m,z.AdministratorModule,d.j,_.mS,M.$6,S.cD,le.KW,pe.BL,ce.b1,de._t,ge.Ju,me.L,ue.W,_e.o,he.w,ze.g,fe.c,Ce.A2,Te.q6,Me.z,xe.g,ve.YS,Ze.p,Ae.YM,be.a,Ke.D,De.vQ,ye.e,Re.p]}),l})()},63106:(se,U,o)=>{o.d(U,{I:()=>$});var t=o(65879),b=o(26254),I=o(62595),m=o(92574),Z=o(42840),f=o(96814),x=o(60095),J=o(62612),C=o(62787),u=o(21406),R=o(52682),A=o(3599),F=o(16676),h=o.n(F),T=o(42012),Y=o(70855),Q=o(41958),K=o(73460);function k(c,z){if(1&c){const d=t.EpF();t.TgZ(0,"button",13)(1,"label",14),t.NdJ("ngModelChange",function(_){t.CHM(d);const M=t.oxw(2);return t.KtG(M.includeArchived=_)})("ngModelChange",function(_){t.CHM(d);const M=t.oxw(2);return t.KtG(M.onArchiveChange(_))}),t._uU(2," Include Archived Projects "),t.qZA()()}if(2&c){const d=t.oxw(2);t.Q6J("ngClass",d.includeArchived?"archived":""),t.xp6(1),t.Q6J("ngModel",d.includeArchived)}}function L(c,z){if(1&c&&(t.ynx(0),t.YNc(1,k,3,2,"button",12),t.BQk()),2&c){const d=t.oxw();t.xp6(1),t.Q6J("ngIf",d.showArchivedToggle)}}function N(c,z){if(1&c&&(t.TgZ(0,"button",17),t._uU(1),t._UZ(2,"span",18),t.qZA()),2&c){const d=t.oxw(3),g=t.MAs(9);t.Q6J("nzDropdownMenu",g)("nzTrigger","click")("nzPlacement","bottomRight"),t.xp6(1),t.hij(" ",d.durationLabel," "),t.xp6(1),t.Q6J("nzType","down")}}function w(c,z){1&c&&(t.ynx(0),t.TgZ(1,"nz-space"),t.YNc(2,N,3,5,"button",16),t.qZA(),t.BQk())}function H(c,z){if(1&c&&(t.TgZ(0,"button",23),t._uU(1," Export "),t._UZ(2,"span",18),t.qZA()),2&c){t.oxw();const d=t.MAs(3),g=t.oxw(2);t.Q6J("nzType","primary")("nzLoading",g.exporting)("nzTrigger","click")("nzDropdownMenu",d)("nzPlacement","bottomRight"),t.xp6(2),t.Q6J("nzType","down")}}function P(c,z){if(1&c){const d=t.EpF();t.TgZ(0,"li",24),t.NdJ("click",function(){t.CHM(d);const _=t.oxw(3);return t.KtG(_.export())}),t._uU(1,"Excel"),t.qZA()}}function j(c,z){if(1&c){const d=t.EpF();t.TgZ(0,"li",24),t.NdJ("click",function(){t.CHM(d);const _=t.oxw(3);return t.KtG(_.export())}),t._uU(1,"PNG"),t.qZA()}}function B(c,z){if(1&c&&(t.ynx(0),t.YNc(1,H,3,6,"button",19),t.TgZ(2,"nz-dropdown-menu",null,20)(4,"ul",21),t.YNc(5,P,2,0,"li",22),t.YNc(6,j,2,0,"li",22),t.qZA()(),t.BQk()),2&c){const d=t.oxw(2);t.xp6(1),t.Q6J("ngIf",d.showExport),t.xp6(4),t.Q6J("ngIf",!d.isPngOnly),t.xp6(1),t.Q6J("ngIf",d.isPngOnly)}}function D(c,z){if(1&c&&(t.ynx(0),t.YNc(1,w,3,0,"ng-container",15),t.YNc(2,B,7,3,"ng-container",2),t.BQk()),2&c){const d=t.oxw();t.xp6(1),t.Q6J("ngIf",d.showDuration)}}function O(c,z){if(1&c){const d=t.EpF();t.TgZ(0,"li",25),t.NdJ("click",function(){const M=t.CHM(d).$implicit,S=t.oxw();return t.KtG(S.onDurationChange(M))}),t._uU(1),t.TgZ(2,"small",26),t._uU(3),t.qZA()()}if(2&c){const d=z.$implicit,g=t.oxw();t.Q6J("nzSelected",d.key===(null==g.selectedDuration?null:g.selectedDuration.key)&&!g.dateRange.length),t.xp6(1),t.hij(" ",d.label," "),t.xp6(2),t.hij(" ",d.dates,"")}}const W=function(){return{standalone:!0}};let $=(()=>{var c;class z{get durationLabel(){const g="yy-MM-DD";return 2==this.dateRange.length?`${h()(this.dateRange[0]).format(g)} - ${h()(this.dateRange[1]).format(g)}`:this.selectedDuration?this.selectedDuration.label:"Duration"}get selectedDuration(){return this.api.getDuration()}constructor(g){this.api=g,this.showExport=!0,this.showDuration=!0,this.showArchivedToggle=!0,this.isPngOnly=!1,this.durationChanged=new t.vpe,this.exportFile=new t.vpe,this.isDurationLabelSelected=new t.vpe,this.includeArchived=!1,this.exporting=!1,this.dateRange=[],this.durations=[{label:"Yesterday",key:u.WD,dates:h()().subtract(1,"days").format("MMM,DD YYYY").toString()},{label:"Last 7 days",key:u.ao,dates:h()().subtract(1,"weeks").format("MMM,DD YYYY").toString()+" - "+h()().format("MMM,DD YYYY").toString()},{label:"Last week",key:u.$U,dates:h()().subtract(1,"weeks").startOf("week").format("MMM,DD YYYY").toString()+" - "+h()().subtract(1,"weeks").endOf("week").format("MMM,DD YYYY").toString()},{label:"Last 30 days",key:u.ly,dates:h()().subtract(1,"month").format("MMM,DD YYYY").toString()+" - "+h()().format("MMM,DD YYYY").toString()},{label:"Last month",key:u.lI,dates:h()().subtract(1,"month").startOf("month").format("MMM,DD YYYY").toString()+" - "+h()().subtract(1,"month").endOf("month").format("MMM,DD YYYY").toString()},{label:"Last 3 months",key:u.o9,dates:h()().subtract(3,"months").format("MMM,DD YYYY").toString()+" - "+h()().format("MMM,DD YYYY").toString()},{label:"All time",key:u.Si,dates:""}]}ngOnInit(){this.setInitialValues()}setInitialValues(){this.api.getDuration()||this.api.setDuration(this.durations.find(g=>g.key===u.ao)||null),this.api.getIncludeToggle()&&(this.includeArchived=this.api.getIncludeToggle())}onArchiveChange(g){this.api.setIncludeToggle(g),this.api.emitIncludeToggleChanged()}onDurationChange(g){this.isDurationLabelSelected.emit(!0),setTimeout(()=>{this.api.setDuration(g),this.api.setDrawerDuration(g),this.dateRange=[],this.api.setDateRange(this.dateRange),this.api.setDrawerDateRange(this.dateRange),this.api.emitDurationChanged()},500)}customDateChange(){this.isDurationLabelSelected.emit(!1),setTimeout(()=>{this.api.setDateRange(this.dateRange),this.api.setDrawerDateRange(this.dateRange),this.api.emitDateRangeChanged()})}export(){this.exportFile.emit()}}return(c=z).\u0275fac=function(g){return new(g||c)(t.Y36(T.m))},c.\u0275cmp=t.Xpm({type:c,selectors:[["worklenz-rpt-header"]],inputs:{title:"title",showExport:"showExport",showDuration:"showDuration",showArchivedToggle:"showArchivedToggle",isPngOnly:"isPngOnly"},outputs:{durationChanged:"durationChanged",exportFile:"exportFile",isDurationLabelSelected:"isDurationLabelSelected"},standalone:!0,features:[t.jDz],decls:21,vars:8,consts:[[1,"site-page-header-ghost-wrapper"],[1,"px-0",3,"nzGhost"],[4,"nzSpaceItem"],["timeSelector","nzDropdownMenu"],["nz-menu","","nzSelectable","",2,"max-height","330px","overflow-y","auto"],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],["nz-menu-divider",""],[1,"px-2","pb-2","pt-2","mt-1","custom-dropdown-range-li"],["nz-form",""],[1,"d-block","mt-1"],[1,"w-100",3,"ngModel","ngModelOptions","ngModelChange"],["nz-button","",1,"mt-2","ms-auto","d-block",3,"nzType","nzSize","click"],["nz-button","",3,"ngClass",4,"ngIf"],["nz-button","",3,"ngClass"],["nz-checkbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzTrigger","nzPlacement",4,"nzSpaceItem"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzTrigger","nzPlacement"],["nz-icon","",3,"nzType"],["nz-button","","nz-dropdown","",3,"nzType","nzLoading","nzTrigger","nzDropdownMenu","nzPlacement",4,"ngIf"],["exportMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-button","","nz-dropdown","",3,"nzType","nzLoading","nzTrigger","nzDropdownMenu","nzPlacement"],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"nzSelected","click"],[1,"ms-auto","text-secondary"]],template:function(g,_){1&g&&(t.TgZ(0,"div",0)(1,"nz-page-header",1)(2,"nz-page-header-title"),t._uU(3),t.qZA(),t.TgZ(4,"nz-page-header-extra")(5,"nz-space"),t.YNc(6,L,2,1,"ng-container",2),t.YNc(7,D,3,1,"ng-container",2),t.qZA()()()(),t.TgZ(8,"nz-dropdown-menu",null,3)(10,"ul",4),t.YNc(11,O,4,3,"li",5),t._UZ(12,"li",6),t.TgZ(13,"li",7)(14,"form",8)(15,"label"),t._uU(16,"Custom range"),t.qZA(),t.TgZ(17,"div",9)(18,"nz-range-picker",10),t.NdJ("ngModelChange",function(S){return _.dateRange=S}),t.qZA()(),t.TgZ(19,"button",11),t.NdJ("click",function(){return _.customDateChange()}),t._uU(20," Filter "),t.qZA()()()()()),2&g&&(t.xp6(1),t.Q6J("nzGhost",!1),t.xp6(2),t.Oqu(_.title),t.xp6(8),t.Q6J("ngForOf",_.durations),t.xp6(7),t.Q6J("ngModel",_.dateRange)("ngModelOptions",t.DdM(7,W)),t.xp6(1),t.Q6J("nzType","primary")("nzSize","small"))},dependencies:[b.KJ,b.$O,b.u9,b.Jp,I.PV,I.Ls,m.zf,m.NU,m.$1,Z.sL,Z.ix,Y.w,Q.dQ,f.mk,x.u5,x._Y,x.JJ,x.JL,x.On,x.F,J.Wr,J.Ie,C.b1,K.wO,K.r9,K.YV,C.cm,C.RR,C.wA,f.sg,R.Hb,R.uw,R.wS,A.U5,A.Lr,f.O5],changeDetection:0}),z})()}}]);