"use strict";(self.webpackChunkworklenz=self.webpackChunkworklenz||[]).push([[771],{63392:(L,P,n)=>{n.d(P,{p:()=>h});var l=n(15861),m=n(96814),u=n(43389),p=n(82669),r=n(96928),a=n(61320),g=n(19035),i=n(24139),c=n(63577),s=n(65879),O=n(64532);function M(f,D){if(1&f&&(s.ynx(0),s._UZ(1,"worklenz-project-updates-list",2),s.BQk()),2&f){const v=s.oxw();s.xp6(1),s.Q6J("projectId",v.projectId)("isLimit",!0)}}const U=function(){return{"padding-bottom":"0px"}};let h=(()=>{var f;class D{constructor(t,C){this.cdr=t,this.utils=C,this.show=!1,this.projectId=null}open(t){var C=this;return(0,l.Z)(function*(){C.show=!0,yield C.list.loadDataOnDrawer(t),C.cdr.markForCheck()})()}handleClose(){this.reset(),this.show=!1}onVisibleChange(t){t&&this.cdr.markForCheck()}reset(){this.projectId=null}}return(f=D).\u0275fac=function(t){return new(t||f)(s.Y36(s.sBO),s.Y36(O.F))},f.\u0275cmp=s.Xpm({type:f,selectors:[["worklenz-project-updates-drawer"]],viewQuery:function(t,C){if(1&t&&s.Gf(c.D,5),2&t){let j;s.iGM(j=s.CRH())&&(C.list=j.first)}},standalone:!0,features:[s.jDz],decls:2,vars:7,consts:[[3,"nzWidth","nzClosable","nzTitle","nzVisible","nzPlacement","nzBodyStyle","nzOnClose","nzVisibleChange"],[4,"nzDrawerContent"],[3,"projectId","isLimit"]],template:function(t,C){1&t&&(s.TgZ(0,"nz-drawer",0),s.NdJ("nzOnClose",function(){return C.handleClose()})("nzVisibleChange",function(T){return C.onVisibleChange(T)}),s.YNc(1,M,2,2,"ng-container",1),s.qZA()),2&t&&s.Q6J("nzWidth",600)("nzClosable",!0)("nzTitle","Project Updates")("nzVisible",C.show)("nzPlacement","right")("nzBodyStyle",s.DdM(6,U))},dependencies:[m.ez,u.BL,u.Vz,u.SQ,p.j,r.Rt,a.YM,g._p,i.H0,c.D],styles:[".comments-block[_ngcontent-%COMP%]{position:absolute;bottom:0;left:24px;right:24px;z-index:1;background:#FAFAFA;margin-left:-1.5rem;margin-right:-1.5rem;border-top:1px solid rgba(0,0,0,.06)}nz-comment-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{-webkit-user-select:text;user-select:text}nz-skeleton[_ngcontent-%COMP%]{margin-top:-16px}worklenz-project-updates-input[_ngcontent-%COMP%]{position:sticky;bottom:0}"],changeDetection:0}),D})()},63577:(L,P,n)=>{n.d(P,{D:()=>Z});var l=n(15861),m=n(96814),u=n(2919),p=n(34302),r=n(96928),a=n(61320),g=n(19035),i=n(24139),c=n(69649),s=n(71993),O=n(42840),M=n(92574),U=n(41958),h=n(60095),f=n(3599),D=n(20824),v=n(36513),t=n(65879),C=n(90586),j=n(9435),T=n(64532),A=n(78066),y=n(88019),B=n(70855);function R(_,E){if(1&_&&(t.TgZ(0,"nz-comment-content"),t._UZ(1,"p",13),t.qZA()),2&_){const d=t.oxw().$implicit;t.xp6(1),t.Q6J("innerHTML",d.content,t.oJD)}}function W(_,E){if(1&_){const d=t.EpF();t.TgZ(0,"nz-comment-action")(1,"span",14),t.NdJ("nzOnConfirm",function(){t.CHM(d);const o=t.oxw().$implicit,z=t.oxw(2);return t.KtG(z.deleteComment(o.id))}),t._uU(2," Delete "),t.qZA()()}2&_&&(t.xp6(1),t.Q6J("nzPopconfirmTitle","Are you sure?"))}function b(_,E){if(1&_&&(t.TgZ(0,"nz-comment",10),t.ALo(1,"fromNow"),t._UZ(2,"nz-avatar",11),t.ALo(3,"firstCharUpper"),t.YNc(4,R,2,1,"nz-comment-content",12),t.YNc(5,W,3,1,"nz-comment-action",12),t.qZA()),2&_){const d=E.$implicit,e=t.oxw(2);t.Q6J("nzAuthor",d.created_by)("nzDatetime",t.lcZ(1,8,d.created_at)),t.xp6(2),t.Udp("background-color",e.utils.getColor(d.created_by)),t.Q6J("nzSrc",d.avatar_url)("nzText",t.lcZ(3,10,d.created_by)),t.xp6(2),t.Q6J("ngIf",d.content),t.xp6(1),t.Q6J("ngIf",e.canDelete(d.user_id))}}function x(_,E){if(1&_&&(t.ynx(0,8),t.YNc(1,b,6,12,"nz-comment",9),t.BQk()),2&_){const d=t.oxw();t.xp6(1),t.Q6J("ngForOf",d.updates)}}function S(_,E){if(1&_){const d=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(d);const o=t.oxw(2);return t.KtG(o.cancel())}),t._uU(1,"Cancel"),t.qZA()}}function K(_,E){if(1&_&&(t.TgZ(0,"button",19),t._uU(1,"Add"),t.qZA()),2&_){const d=t.oxw(2);t.Q6J("disabled",!d.isValid())}}function F(_,E){1&_&&(t.TgZ(0,"div",15)(1,"nz-space"),t.YNc(2,S,2,0,"button",16),t.YNc(3,K,2,1,"button",17),t.qZA()())}const $=function(_,E){return{minRows:_,maxRows:E}};let Z=(()=>{var _;class E{constructor(e,o,z,I,J,Y,k){this.fb=e,this.app=o,this.cdr=z,this.auth=I,this.utils=J,this.api=Y,this.service=k,this.projectId=null,this.isLimit=!1,this.loading=!1,this.commentsInputFocused=!1,this.loadingMembers=!1,this.creatingComment=!1,this.search=null,this.updates=[],this.projectMembers=[],this.mentions=[],this.valueWith=w=>w.name,this.form=this.fb.group({content:[null,[h.kI.required,h.kI.maxLength(2e3)]]}),this.service.onRefresh.pipe((0,s.sL)()).subscribe(()=>{this.get()})}ngOnInit(){this.get(),this.getProjectMembers(),this.getCount(),this.service.emitBadgeDisable()}ngOnDestroy(){this.projectMembers=[],this.search=null,this.mentions=[]}get rows(){return this.cdr.markForCheck(),this.commentsInputFocused?4:1}updateLocalCount(e){return localStorage.setItem("worklenz.project.updates-"+this.projectId,e)}loadDataOnDrawer(e){var o=this;return(0,l.Z)(function*(){o.projectId=e,yield o.get(),yield o.getProjectMembers(),yield o.getCount()})()}get(){var e=this;return(0,l.Z)(function*(){if(e.projectId)try{e.loading=!0;const o=yield e.api.getByProjectId(e.projectId,e.isLimit);o&&(e.updates=o.body,e.loading=!1,e.cdr.markForCheck())}catch(o){(0,c.tu)(o),e.loading=!1,e.cdr.markForCheck()}})()}getCount(){var e=this;return(0,l.Z)(function*(){if(e.projectId)try{const o=yield e.api.getCountByProjectId(e.projectId);o&&(e.updateLocalCount(o.body.toString()),e.cdr.markForCheck())}catch(o){(0,c.tu)(o),e.cdr.markForCheck()}})()}getProjectMembers(){var e=this;return(0,l.Z)(function*(){if(e.projectId)try{e.loadingMembers=!0;const o=yield e.api.getMembers(e.projectId,1,5,null,null,e.search);o.done&&(e.projectMembers=o.body||[]),e.loadingMembers=!1,e.cdr.markForCheck()}catch(o){e.loadingMembers=!1,(0,c.tu)(o),e.cdr.markForCheck()}})()}setFocus(e){this.commentsInputFocused=e}create(){var e=this;return(0,l.Z)(function*(){if(e.projectId&&e.form.value.content&&""!==e.form.value.content.trim())try{e.creatingComment=!0;const o=e.auth.getCurrentSession(),z={project_id:e.projectId,team_id:o?.team_id,content:e.form.value.content,mentions:[...new Set(e.mentions||[])]};(yield e.api.create(z))&&(yield e.get(),yield e.getCount(),e.service.emitGetLastUpdate(),e.reset()),e.creatingComment=!1,e.cdr.markForCheck()}catch(o){(0,c.tu)(o),e.creatingComment=!1,e.cdr.markForCheck()}})()}onSearchChange({value:e}){this.search=e}onSelect(e){!e||!e.id||!e.name||this.mentions.some(o=>o.id===e.id)||this.mentions.push({id:e.id,name:e.name})}cancel(){this.setFocus(!1),this.form.reset()}isValid(){return this.form.valid}submit(){this.form.valid?this.create():this.app.displayErrorsOf(this.form)}canDelete(e){return!!e&&e===this.auth.getCurrentSession()?.id}deleteComment(e){var o=this;return(0,l.Z)(function*(){if(e)try{(yield o.api.deleteById(e))&&(yield o.get(),yield o.getCount(),o.service.emitGetLastUpdate())}catch(z){(0,c.tu)(z)}})()}trackById(e){return e.id}reset(){this.mentions=[],this.form.reset(),this.creatingComment=!1}}return(_=E).\u0275fac=function(e){return new(e||_)(t.Y36(h.qu),t.Y36(C.z),t.Y36(t.sBO),t.Y36(j.e),t.Y36(T.F),t.Y36(A.L),t.Y36(y.k))},_.\u0275cmp=t.Xpm({type:_,selectors:[["worklenz-project-updates-list"]],inputs:{projectId:"projectId",isLimit:"isLimit"},standalone:!0,features:[t.jDz],decls:8,vars:16,consts:[[3,"nzLoading"],["class","comments-list",4,"ngIf"],["nz-form","",3,"formGroup","submit"],[3,"nzSuggestions","nzValueWith","nzLoading","nzNotFoundContent","nzOnSearchChange","nzOnSelect","click"],[3,"nzMaxCharacterCount"],["nz-input","","placeholder","Add a comment...","nzMentionTrigger","",1,"border-0",3,"formControlName","maxlength","rows","nzAutosize"],["input",""],["class","mt-3 justify-content-end d-flex",4,"ngIf"],[1,"comments-list"],[3,"nzAuthor","nzDatetime",4,"ngFor","ngForOf"],[3,"nzAuthor","nzDatetime"],["nz-comment-avatar","",3,"nzSrc","nzText"],[4,"ngIf"],[1,"mention-text",3,"innerHTML"],["nz-popconfirm","",3,"nzPopconfirmTitle","nzOnConfirm"],[1,"mt-3","justify-content-end","d-flex"],["type","button","nz-button","","nzType","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzType","primary",3,"disabled",4,"nzSpaceItem"],["type","button","nz-button","","nzType","default",3,"click"],["type","submit","nz-button","","nzType","primary",3,"disabled"]],template:function(e,o){1&e&&(t.TgZ(0,"nz-skeleton",0),t.YNc(1,x,2,1,"ng-container",1),t.TgZ(2,"form",2),t.NdJ("submit",function(){return o.submit()}),t.TgZ(3,"nz-mention",3),t.NdJ("nzOnSearchChange",function(I){return o.onSearchChange(I)})("nzOnSelect",function(I){return o.onSelect(I)})("click",function(){return o.setFocus(!0)}),t.TgZ(4,"nz-textarea-count",4),t._UZ(5,"textarea",5,6),t.qZA()(),t.YNc(7,F,4,0,"div",7),t.qZA()()),2&e&&(t.Q6J("nzLoading",o.loading),t.xp6(1),t.Q6J("ngIf",o.updates.length),t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("nzSuggestions",o.projectMembers)("nzValueWith",o.valueWith)("nzLoading",o.loadingMembers)("nzNotFoundContent","No members found!"),t.xp6(1),t.Q6J("nzMaxCharacterCount",2e3),t.xp6(1),t.Q6J("formControlName","content")("maxlength",2e3)("rows",o.rows)("nzAutosize",t.WLB(13,$,o.rows,o.rows)),t.xp6(2),t.Q6J("ngIf",o.commentsInputFocused))},dependencies:[m.ez,m.sg,m.O5,u.I,p.d,r.Rt,r.Dz,a.YM,a.WE,a.DA,a.Y4,a.Ql,g._p,g.JW,i.H0,i.ng,O.sL,O.ix,B.w,U.dQ,f.U5,f.Lr,D.o7,D.w,D.Zp,D.rh,v.Gl,v.YW,v.jO,M.zf,M.NU,M.$1,U.vG,h.UX,h._Y,h.Fj,h.JJ,h.JL,h.nD,h.sg,h.u,h.u5],styles:["textarea[_ngcontent-%COMP%]{box-shadow:none!important}form[_ngcontent-%COMP%]{background-color:#fff;position:sticky;bottom:0;padding-top:12px;padding-bottom:18px}"],changeDetection:0}),E})()},53980:(L,P,n)=>{n.d(P,{s:()=>p});var l=n(26857),m=n(65879),u=n(69862);let p=(()=>{var r;class a extends l.P{constructor(i){super(),this.http=i,this.root=`${this.API_BASE_URL}/project-categories`}create(i){return this._post(this.http,this.root,i)}get(){return this._get(this.http,`${this.root}`)}getByTeamId(i){return this._get(this.http,`${this.root}/${i}`)}getByOrg(){return this._get(this.http,`${this.root}/org-categories`)}updateColor(i,c){return this._put(this.http,`${this.root}/${i}`,{color:c})}deleteById(i){return this._delete(this.http,`${this.root}/${i}`)}}return(r=a).\u0275fac=function(i){return new(i||r)(m.LFG(u.eN))},r.\u0275prov=m.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),a})()},78066:(L,P,n)=>{n.d(P,{L:()=>r});var l=n(26857),m=n(69649),u=n(65879),p=n(69862);let r=(()=>{var a;class g extends l.P{constructor(c){super(),this.http=c,this.root=`${this.API_BASE_URL}/project-comments`}create(c){return this._post(this.http,`${this.root}`,c)}getMembers(c,s,O,M,U,h){const f=encodeURIComponent(h||""),D=`${this.root}/project-members/${c}${(0,m.UK)({index:s,size:O,field:M,order:U,search:f})}`;return this._get(this.http,D)}getCountByProjectId(c){return this._get(this.http,`${this.root}/comments-count/${c}`)}getByProjectId(c,s){const O=`${this.root}/project-comments/${c}${(0,m.UK)({latest:s})}`;return this._get(this.http,O)}deleteById(c){return this._delete(this.http,`${this.root}/delete/${c}`)}}return(a=g).\u0275fac=function(c){return new(c||a)(u.LFG(p.eN))},a.\u0275prov=u.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),g})()},19350:(L,P,n)=>{n.d(P,{w:()=>p});var l=n(26857),m=n(65879),u=n(69862);let p=(()=>{var r;class a extends l.P{constructor(i){super(),this.http=i,this.root=`${this.API_BASE_URL}/project-healths`}get(){return this._get(this.http,this.root)}}return(r=a).\u0275fac=function(i){return new(i||r)(m.LFG(u.eN))},r.\u0275prov=m.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),a})()},52732:(L,P,n)=>{n.d(P,{k:()=>p});var l=n(26857),m=n(65879),u=n(69862);let p=(()=>{var r;class a extends l.P{constructor(i){super(),this.http=i,this.root=`${this.API_BASE_URL}/project-statuses`}get(){return this._get(this.http,this.root)}}return(r=a).\u0275fac=function(i){return new(i||r)(m.LFG(u.eN))},r.\u0275prov=m.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),a})()},88019:(L,P,n)=>{n.d(P,{k:()=>u});var l=n(78645),m=n(65879);let u=(()=>{var p;class r{constructor(){this._emitRefreshSbj$=new l.x,this._disableBadgeSbj$=new l.x,this._getLastUpdateSbj$=new l.x}get onRefresh(){return this._emitRefreshSbj$.asObservable()}get onBadgeDisable(){return this._disableBadgeSbj$.asObservable()}get onGetLatestUpdate(){return this._getLastUpdateSbj$.asObservable()}emitRefresh(){this._emitRefreshSbj$.next()}emitBadgeDisable(){this._disableBadgeSbj$.next()}emitGetLastUpdate(){this._getLastUpdateSbj$.next()}}return(p=r).\u0275fac=function(g){return new(g||p)},p.\u0275prov=m.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),r})()}}]);